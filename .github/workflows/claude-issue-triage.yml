name: Claude Issue Triage

on:
  issue_comment:
    types: [created]

jobs:
  triage:
    if: contains(github.event.comment.body, '@claude')
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
      id-token: write

    steps:
      - uses: actions/checkout@v4

      - name: Triage with Claude
        uses: anthropics/claude-code-action@beta
        with:
          trigger_phrase: "@claude"
          branch_prefix: "claude-"
          custom_instructions: |
            Context for this repository:
            - This is a Textbringer plugin for Tree-sitter syntax highlighting
            - Issues labeled "upstream-sync" are auto-generated by workflows
            - FAVEOD_VERSION in exe/textbringer-tree-sitter defines the current parser version

            For "upstream-sync" issues:
            1. Check if it's a false positive (already addressed)
            2. If new node types: suggest which ones might need Face mappings
            3. If new parser version: check if we're already using it

            Respond in a concise, helpful manner.
