name: Claude Issue Triage

on:
  issues:
    types: [opened]

jobs:
  triage:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
      id-token: write

    steps:
      - uses: actions/checkout@v4

      - name: Triage with Claude
        uses: anthropics/claude-code-action@beta
        with:
          direct_prompt: |
            Analyze this GitHub issue and provide a helpful response.

            Issue Title: ${{ github.event.issue.title }}
            Issue Body: ${{ github.event.issue.body }}
            Labels: ${{ join(github.event.issue.labels.*.name, ', ') }}

            Context:
            - This is a Textbringer plugin for Tree-sitter syntax highlighting
            - Issues labeled "upstream-sync" are auto-generated by workflows
            - FAVEOD_VERSION in exe/textbringer-tree-sitter defines the current parser version

            For "upstream-sync" issues:
            1. Check if it's a false positive (already addressed)
            2. If new node types: suggest which ones might need Face mappings
            3. If new parser version: check if we're already using it

            For regular issues:
            1. Acknowledge the issue
            2. Provide initial analysis
            3. Suggest next steps if applicable

            Respond in a concise, helpful manner. If the issue is a false positive,
            recommend closing it with a brief explanation.
